---
title: "Availability of Abitur and Non-Abitur Upper Secondary Schools and Housing Prices in NRW"
authors:
  - name: "Julian Schilling"
  - name: "Benedikt Teuber"
  - name: "Elena Preussner"
aspectratio: 169
bibliography: references.bib
date: today
date-format: "DD.MM.YYYY"

format:
  beamer:
    toc: true
    cite-method: biblatex
    biblatexoptions:
      - style=apa
      - backend=biber
    theme: default

    include-in-header:
      text: |
        % --- Fonts ---
        \usepackage[sfdefault]{FiraSans}
        \usefonttheme{professionalfonts}

        % --- Logo + Seminarinfos NUR auf der Titelfolie ---
        \usepackage{graphicx}
        \usepackage{tikz}

        \newcommand{\seminartitel}{Course: Data Analysis using R}
        \newcommand{\fakultaet}{Chair: Chair of empirical economics}
        \newcommand{\lehrperson}{Lecturer: Sven Werenbeck-Ueding}

        \addtobeamertemplate{title page}{}{%
          \begin{tikzpicture}[remember picture,overlay]
            \node[anchor=south west, xshift=0.5cm, yshift=0.5cm]
              at (current page.south west) {%
              \begin{minipage}[c]{0.9\textwidth}
                \begin{minipage}[c]{0.40\textwidth}
                  \includegraphics[height=0.9cm]{Logo_rub.jpg}
                \end{minipage}\hspace{0.03\textwidth}%
                \begin{minipage}[c]{0.62\textwidth}
                  {\small \fakultaet\par}
                  {\small \seminartitel\par}
                  {\small \lehrperson\par}
                \end{minipage}
              \end{minipage}
            };
          \end{tikzpicture}
        }

        % --- Slide numbers ---
        \setbeamertemplate{footline}{%
          \hfill\usebeamerfont{page number in head/foot}%
          \insertframenumber/\inserttotalframenumber\kern1em\vskip2pt%
        }
        \setbeamertemplate{navigation symbols}{}

        % --- Tables/captions ---
        \usepackage{caption}
        \usepackage{etoolbox}


        \addtobeamertemplate{frametitle}{}{\vspace{6pt}}
        \AtBeginEnvironment{table}{\raggedright}

        \captionsetup[table]{justification=raggedright,singlelinecheck=false,skip=0pt}
        \setlength{\abovecaptionskip}{0pt}
        \setlength{\belowcaptionskip}{0pt}

        % --- Your styling ---
        \usepackage{tcolorbox}
        \tcbset{
          colback=blue!5,
          colframe=blue!50!black,
          boxrule=0.4pt,
          arc=2pt,
          left=4pt,
          right=4pt,
          top=3pt,
          bottom=3pt
        }
        \setbeamercolor{structure}{fg=black}
        \setbeamerfont{frametitle}{series=\bfseries}
        \setbeamerfont{section title}{series=\bfseries}
        \setbeamertemplate{itemize item}{\textbullet}
        \setbeamertemplate{itemize subitem}{\textbullet}
        \setbeamertemplate{itemize subsubitem}{\textbullet}
        \usepackage{multicol}
        \tcolorboxenvironment{block}{}
        \tcolorboxenvironment{alertblock}{}
        \tcolorboxenvironment{exampleblock}{}
        \usepackage{amssymb}
        \usepackage{booktabs}
        \setlength{\abovetopsep}{2pt}
        \setlength{\aboverulesep}{2pt}
        \setlength{\belowrulesep}{2pt}
        \setlength{\textfloatsep}{3pt}
        \setlength{\intextsep}{3pt}

execute:
  echo: false
  
---

```{r setup}
#| include: false
library(tidyverse)
library(ggplot2)
library(knitr)
library(kableExtra)
library(stargazer)
library(tibble)

setwd("..")

source("scripts/1_data_preparation.R")
source("scripts/2_treatment_assignment.R")
source("scripts/3_matching_observations.R")
source("scripts/4_descriptives.R")
source("scripts/5_regression_analysis.R")
source("scripts/7_robustness_checks.R")
```

# Introduction

## Research Question
   \begin{block}{Main question}
To what extent does the local availability of upper secondary schools that offer an Abitur pathway, compared to other secondary schools, affect housing prices in North Rhine-Westphalia (NRW)?
\end{block}
- Goal: Estimating heterogeneity in the capitalization of secondary schools that offer the possibility to achieve higher educational outcomes.
- We assume that parents are willing to pay a premium for their homes, if a school lies within 3km at which their children can make an Abitur (Gymnasium or Gesamtschule)
- Therefore, we restrict our analysis on different types of secondary schools and exclude elementary schools and other specialised or private schools

## Motivation and Institutional Context 
- School availability and quality in general are important determinants of housing decisions and are capitalized into housing prices (..)
- However, existing evidence on capitalization differences across upper secondary school tracks is limited, while most hedonic price studies face endogeneity concerns.
- The \textbf{magnitude of capitalization effects may differ by school track}
- Germany’s multi-track secondary school system provides a unique setting to study differential capitalization effects.
- In NRW the 2008/09 reform increased freedom in school-choice and weakens formal residence–school links as it may \textbf{increase behavioral selection} into high-quality school areas.

\begin{block}{Key Insight:}
    When school choice is flexible, households with strong school preferences are more likely to relocate to access better schools — reinforcing the link between school quality and housing prices. \parencite{bayer2007}
    \end{block}

# Theoretical Framework

## Tiebout sorting

- The decision-making process of residents include the availability and quality of provided public goods and services within a municipality 
- Under the assumption of perfect mobility, residents pick that community that exactly satisfies their preferences \parencite{tiebout1956}
- If such a community or municipality is not feasible, a perfect substitute (if existent) is to be chosen

## What do parents value?

- Educational quality is an important part of the set of considered public goods, because quality schooling is often decisive in later life-outcomes (e.g. labor market opportunities, gained income, health etc.) 
- The way in which parents sort into the housing market directly influencing the level of residentual segregation \parencite{bayer2007}
- Ongoing debate, which dimension of education is valued by parents (outputs or learning environments containing sociodemographic composition) \parencite{machin2011}
- We want to test whether the availability of upper secondary schools is such a dimension 

## Capitalization mechanism

- Parents are willing to pay a premium for housing units nearby top-tier school networks \parencite{jayantha2015}

This capitalizes into the housing market via two mechanisms \parencite{la2015}:

- Wealthier households that care about school quality bid up prices within the walking zone of a school
- generation of spillovers through changes in neighborhood composition

## Hypothesis

Based on the theoretical background, we expect the following results:

- Education is one of the most important public services \parencite{zhang2020} and it is therefore reasonable to test the channel
- Educational opportunities play a role in parents’ housing decisions
- Parents value the opportunity to achieve higher educational outcomes for their children \parencite{hornig2025} because of their decisiveness for later life outcomes
- Parents are therefore willing to pay a premium for houses near a secondary school offering the opportunity to obtain an *Abitur*


\begin{block}{Formal Hypothesis}
\[
\begin{aligned}
\tau_{\text{school}} & \text{(Estimated treatment effect):} & H_1 &: \beta_1 (D_i) > 0 \\
\tau_{\text{abitur}} & \text{(Estimated treatment heterogeneity):} & H_2 &: \beta_2 (D_i \times A_i)  > 0
\end{aligned}
\]
\end{block}


# Insights from relevant empirical literature

## Literature Insights (excerpt)

- The empirical literature mainly focused on the capitalization effects of school quality
- UK: Strong capitalization of \textbf{primary school} performance into housing prices. \parencite{gibbons2003}
- US: Stronger price effects from \textbf{middle and high school} quality than from elementary schools.\parencite{sedgley2008}
- France: Secondary school quality capitalized more strongly in areas without \textbf{private school alternatives}. \parencite{fack2010}

    

# Empirical Design

## Basic Identification Assumptions

**Theoretical Assumptions:**

- Parents (Households) derive utility from the perceived quality of schooling \parencite{brunner2012}
available to their child
- Parents consider the availability of Abitur and non-Abitur upper secondary schools in their housing decisions.

**Empirical Assumptions:**

- Parents’ preferences for their children’s education are reflected in hedonic price regressions.
- Conditional on the controlling for both housing and neighborhood characteristics, the treatment assignment can considered to be random.
- Within the treatment area and the control area, the capitalization effect is constant.

## Assumptions (II)

- Buildings inside and outside of the treatment zones share the same average housing and neighborhood characteristics.
- Offer prices are time-independently exceeding sale prices at a constant rate.
- Property prices can be interpreted as the willingness to pay for amenities because they are determined by relevant characteristics


## Data and Variables
\textbf{Housing Data:}

- Geo-referenced listings of sales properties \parencite{FDZ2023}
- Variables: living area, site area, number of rooms, number of bathrooms, year of construction, cellar

\vspace{0.2cm}
\textbf{School Data}:

- Locations and types of schools (Grammar School, Comprehensive School, etc. based on grid cells) 

\vspace{0.2cm}
\textbf{Regional Data:}

- Includes information on neighborhood characteristics (e.g. income levels, migration rates, average age and the availability of infrastructure such as doctors or a supermarket)


## Quasi-experimental approach
\begin{columns}[T] % top aligned

  % -------- LEFT COLUMN --------
  \begin{column}{0.55\textwidth}
    We define spatial treatment zones to estimate the causal effect of upper secondary schools on housing prices using grid-cells:

    \vspace{0.6em}

    \begin{itemize}
      \item \textbf{Treatment-Zone:} Grid-cells \textbf{within 2 km} radius
      \item \textbf{Untreated zone:} Grid-cells \textbf{2--4 km} from any school
      \item Houses exposed to multiple secondary schools (double-treated) are excluded
    \end{itemize}
  \end{column}

  % -------- RIGHT COLUMN --------
  \begin{column}{0.45\textwidth}
    \centering
    \includegraphics[width=\linewidth]{plot_zones_no_buffer.pdf}
  \end{column}

\end{columns}

\begin{block}{Robustness check}
As a robustness check, we exclude a \textbf{Buffer zone} of 1km around the treatment zone to prevent spillover contamination, therefore reducing the amount of control units
\end{block}



## Identification Framework
\textbf{Potential Outcome Model (POM):} following \cite{Rubin1974}
$$\ln(P_{ij}) =
\begin{cases}
\ln(P_{1ij}) & \text{if } D_i = 1, \\
\ln(P_{0ij}) & \text{if } D_i = 0.
\end{cases}
\]
\noindent\textbf{where:}
\[
\begin{aligned}
\ln(P_{1ij}) &:\ \text{Price of the house, when it lies in the treatment-zone}\\
              &\quad \text{near to a secondary school}.\\
\ln(P_{0ij}) &:\ \text{Price of the house, when it would not have been 'exposed'}\\
              &\quad \text{to a secondary school (counterfactual)}.
\end{aligned}$$
\begin{block}{Note}
Since the counterfactual is not observed, we use the most similar house
lying in the non-treated zone as a proxy for the counterfactual.
\end{block}


## Matching Strategy
Identification Assumption (CIA): $$ \ln(P_{0ij}), \ln(P_{1ij}) \;\perp\; D \;\big| X_i$$
\textbf{Estimation method:} We use \textbf{matching} on observable covariates to compare treated and untreated buildings:

- Building characteristics (e.g., living area, number of rooms, building age, )
- Neighborhood characteristics (e.g., average income or age, share of immigrants, structural features)

After successful matching, the treatment effect is estimated through the following equation \parencite{tchatoka2021}:

$$
\begin{aligned}
\tau_{\text{school}} 
&= \mathbb{E}\!\left[ \ln(P_{1ij}) - \ln(P_{0ij}) \,\middle|\, X_i \right] \\
&= \mathbb{E}\!\left[ \ln(P_{1ij}) \,\middle|\, X_i, D = 1 \right]
  - \mathbb{E}\!\left[ \ln(P_{0ij}) \,\middle|\, X_i, D = 0 \right]
\end{aligned}
$$


## Econometric Model (OLS Specification) - First model
We estimate the following log-linear autoregressive hedonic regression for elementary and secondary schools each \parencite{lu2023}:

$$
\log(\text{P}_i)
= \alpha
+ \beta_1 \, D_i
+ \mathbf{X}_i' \boldsymbol{\gamma}
+ \mathbf{N}_i' \boldsymbol{\delta}
+ \text{FE}_{r(i)}
+ \varepsilon_i
$$

\textbf{Where:}

- log($P_i$): price of a building per $m^2$
- $D_i$: Is within treatment distance to a secondary school (=1) or not (=0)
- $\mathbf{X}_i$: set of building characteristics 
- $\mathbf{N}_i$: set of neighborhood characteristics
- $\text{FE}_{r(i)}$: Regional fixed effects to account for spatial effects at the municipality level
- $\varepsilon_i$: error term


## Multiple treatment regime - Second model

We are especially interested in the price premium of an available school that offers academic track compared to other secondary schools (treatment heterogeneity).

The basic specifiaction is extended referring to a multiple treatment regime:

$$
\log(\text{P}_i)
= \alpha
+ \beta_1 \, D_i
+ \beta_2 (D_i \times A_i)
+ \mathbf{X}_i' \boldsymbol{\gamma}
+ \mathbf{N}_i' \boldsymbol{\delta}
+ \text{FE}_{r(i)}
+ \varepsilon_i
$$
\textbf{Where:}

- $A_i$: Nearest school offers academic track (=1), otherwise (=0)
- All other variables are the same as for the main specification



## Challenges and Limitations
- \textbf{Endogeneity:} better schools tend to be located in affluent neighborhoods and students endowed with those priviledged backgrounds generally achieve higher educational outcomes \parencite{fack2010}
- \textbf{Assumptions}: It may be unrealistic that the capitalization effects of upper secondary schools are uniform across the whole space \parencite{wen2018}
- \textbf{School access rules:} In some regions, school choice or private alternatives may weaken capitalization effects.
- \textbf{Interpretation:} It is arguably that property prices can be interpreted as the willingness to pay for amenities \parencite{jayantha2015} and therefore the difference between the groups as a premium for educational opportunities
- \textbf{Price validity:} Property prices from ImmoScout are \textit{asking prices} — not actual transaction prices. This has implications on the interpretations of the results and has to be taken into account.
- \textbf{Data:} Incomplete sets of observed building ($\mathbf{X}_i$) and neighborhood ($\mathbf{N}_i$) characteristics

# Results

## Descriptives - Summary Statistics
```{r}
#| echo: false
summary_4groups_table %>%
  kable(format = "latex", booktabs = TRUE, digits = 2, linesep = "",
        col.names = c("Variable", rep(c("Mean", "SD"), 4))) %>%
  add_header_above(c(" " = 1, "Any School" = 2, "Abitur" = 2, 
                     "Non-Abitur" = 2, "Control" = 2)) %>%
  kable_styling(font_size = 7, latex_options = "scale_down")
```

## Descriptives - Balance Check

**School nearby vs. Control**
```{r}
#| echo: false
balance_table %>%
  kable(format = "latex", booktabs = TRUE, digits = 3, linesep = "",
        col.names = c("Variable", "Treatment", "Control", "Std. Diff.", "t-stat")) %>%
  kable_styling(font_size = 8, latex_options = "scale_down")
```

## Descriptives - Scatterplot

```{r, out.width="80%", fig.align="center"}
#| echo: false
balance_plot
```

## Main specification

```{r, out.width= "80%"}
#| label: table-main
#| results: asis
#| echo: false

models_main <- list(
  "(1)"      = m1,
  "(2)"  = m2,
  "(3)"          = m3,
  "(1)"     = m1_matched,
  "(2)" = m2_matched,
  "(3)"         = m3_matched
)
cat("\\begin{minipage}{\\linewidth}\n")
cat("\\textbf{Effect of Secondary School Proximity on House Prices}\\par\\vspace*{-3em}\n")

modelsummary(
  models_main,
  coef_omit = "^(?!school_nearby$).*",
  coef_map  = c("school_nearby" = "School nearby"),
  
  add_rows = data.frame(
    term = c("Building controls", "Neighborhood controls", "Region fixed effects"),
    "(1)" = c("-", "-", "Yes"),
    "(2)" = c("Yes", "-", "Yes"),
    "(3)" = c("Yes", "Yes", "Yes"),
    "(4)" = c("-", "-", "Yes"),
    "(5)" = c("Yes", "-", "Yes"),
    "(6)" = c("Yes", "Yes", "Yes"),
    check.names = FALSE
  ),
  
  gof_map = data.frame(
    raw   = c("nobs", "r.squared"),
    clean = c("Observations", "R²"),
    fmt   = c(0, 3)
  ),
  
  #title = "Effect of Secondary School Proximity on House Prices",
  stars = TRUE,
  gof_omit = "IC|Log|Adj",
  notes = "Note: Robust standard errors clustered at the municipality level in parentheses.",
  
  output = "kableExtra"
)%>%
  kableExtra::kable_styling(full_width = FALSE, position = "left") %>%
  # 1) Erst die Gruppenzeile
  kableExtra::add_header_above(
    c(" " = 1, "Unmatched sample" = 3, "Matched sample" = 3),
    bold = FALSE, line = TRUE
  )
cat("\\end{minipage}\n")
```

## Heterogeneity Model

```{r}
#| label: table-heterogeneity
#| results: asis
#| echo: false

cat("\\begin{minipage}{\\linewidth}\n")
cat("\\textbf{Effect of School with academic track proximity on House Prices}\\par\\vspace*{-3em}\n")
modelsummary(
  list(
    "Full" = model_heterogeneity,
    "Full" = model_heterogeneity_matched
  ),
  statistic = "({std.error})",
  stars = c('*' = .10, '**' = .05, '***' = .01),
  
  coef_omit = "^(?!(school_nearby$|school_nearby:abitur_nearby$)).*",
  coef_map  = c(
    "school_nearby" = "School nearby",
    "school_nearby:abitur_nearby" = "School nearby × Gymnasium nearby"
  ),
  
  gof_map = data.frame(
    raw   = c("nobs", "r.squared"),
    clean = c("Observations", "R²"),
    fmt   = c(0, 3)
  ),
  
  add_rows = data.frame(
    term = c("Building controls", "Neighborhood controls", "Region fixed effects"),
    "(1)" = c("Yes", "Yes", "Yes"),
    "(2)" = c("Yes", "Yes", "Yes"),
    check.names = FALSE
  ),
  
  #title = "Effect of School with academic track proximity on House Prices",
  gof_omit = "IC|Log|Adj",
  notes = "Note: Robust standard errors clustered at the municipality level in parentheses.",
  
  output = "kableExtra"  
) %>%
  kableExtra::kable_styling(full_width = FALSE, position = "left") %>%
  add_header_above(
    c(
      " " = 1,
      "Unmatched sample" = 1,
      "Matched sample"   = 1
    )
  )
cat("\\end{minipage}\n")
```

## Robustness check

```{r}
#| label: table-robustness
#| results: asis
#| echo: false

cat("\\begin{minipage}{\\linewidth}\n")
cat("\\textbf{Effect on housing prices}\\par\\vspace*{-3em}\n")
modelsummary(
  list(
    "(1)"      = model_robustness,
    "(2)" = model_heterogeneity_robustness,
    "(1)"      = model_robustness_matched,
    "(2)" = model_heterogeneity_robustness_matched
  ),
  statistic = "({std.error})",
  stars = c('*' = .10, '**' = .05, '***' = .01),
  coef_omit = "^(?!(school_nearby$|school_nearby:abitur_nearby$)).*",
  coef_map  = c(
    "school_nearby" = "School nearby",
    "school_nearby:abitur_nearby" = "School nearby × Gymnasium nearby"
  ),
  add_rows = data.frame(
    term = c("Building controls", "Neighborhood controls", "Region fixed effects"),
    "(1)" = c("Yes", "Yes", "Yes"),
    "(2)" = c("Yes", "Yes", "Yes"),
    "(3)" = c("Yes", "Yes", "Yes"),
    "(4)" = c("Yes", "Yes", "Yes"),
    check.names = FALSE
  ),
  gof_map = data.frame(
    raw   = c("nobs", "r.squared"),
    clean = c("Observations", "R²"),
    fmt   = c(0, 3)
  ),
  gof_omit = "IC|Log|Adj",
  notes = "Note: Robust standard errors clustered at the municipality level in parentheses.",
  output = "kableExtra"
) %>%
  kableExtra::kable_styling(full_width = FALSE, position = "left") %>%
  kableExtra::add_header_above(
    c(" " = 1, "Unmatched sample" = 2, "Matched sample" = 2)
  )

cat("\\end{minipage}\n")
```

# Policy Implications and further research

# Appendix

## Controls (1/2)

```{r}
controls_table <- tibble(
  Variable = c(
    "living_area",
    "site_area",
    "rooms_n",
    "baths_n",
    "age_building",
    "cellar",
    "immigrants_percents",
    "average_age",
    "pharmacy",
    "hospital",
    "doctors",
    "park"
  ),
  Description = c(
    "Living area of the dwelling (m²)",
    "Site area of the dwelling (m²)",
    "Number of rooms",
    "Number of baths",
    "Age of the building (years)",
    "Dummy for presence/absence of a cellar",
    "Share of immigrants in the 1 km² grid (%)",
    "Average age of residents in the 1km² grid (years)",
    "(=1) if the grid-cell contains at least 1 pharmacy, (=0) otherwise",
    "(=1) if the grid-cell contains at least 1 hospital, (=0) otherwise",
    "(=1) if the grid-cell contains at least 1 doctor's office, (=0) otherwise",
    "(=1) if the grid-cell contains at least 1 park, (=0) otherwise"
  )
)



controls_table[1:6, ] %>%
  kable(
    booktabs = TRUE,
    caption = "Property characteristics"
  )
```

## Controls (1/2)
```{r}
controls_table[7:12, ] %>%
  kable(
    booktabs = TRUE,
    caption = "Neighborhood characteristics"
  )
```

# Literature





